{"ast":null,"code":"import _objectSpread from\"C:/Users/sinajp/OneDrive - SAS/Documents/GitHub/ajay17m.github.io-1/viya_app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/sinajp/OneDrive - SAS/Documents/GitHub/ajay17m.github.io-1/viya_app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState,useContext}from'react';import{useHistory}from'react-router-dom';import Instance from'../apis/Instance';import{AuthContext}from'../contexts';import Container from'react-bootstrap/Container';import JobSelector from'../components/Selectors/JobSelector';import TableViewer from'../components/TableViewer/TableViewer';import Loading from'../components/Loading';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Jobs(){var _useContext=useContext(AuthContext),authInfo=_useContext.authInfo,setAuthInfo=_useContext.setAuthInfo;var _useState=useState({library:null,table:null}),_useState2=_slicedToArray(_useState,2),selection=_useState2[0],setSelection=_useState2[1];var _useState3=useState({rows:[],columns:[]}),_useState4=_slicedToArray(_useState3,2),tableData=_useState4[0],setTableData=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var history=useHistory();useEffect(function(){if(authInfo.authenticated===false){history.push(\"/logon\");}},[authInfo.authenticated,history]);useEffect(function(){if(authInfo.authenticated===true&&!(\"job\"in authInfo.csrf)){var endpoint=\"SASJobExecution/csrf\";Instance.get(endpoint).then(function(response){setAuthInfo(_objectSpread(_objectSpread({},authInfo),{},{csrf:_objectSpread(_objectSpread({},authInfo.csrf),{},{job:response.data})}));});}},[authInfo,setAuthInfo]);useEffect(function(){if(selection.table!==null){var endpoint=\"SASJobExecution/\";var headers={'X-CSRF-HEADER':'X-CSRF-TOKEN','X-CSRF-TOKEN':authInfo.csrf.job};var params={_program:\"/gelcontent/Demo/VISUAL/Jobs/extractData\",reqType:\"getdata\",lib:selection.library,ds:selection.table};Instance.get(endpoint,{headers:headers,params:params}).then(function(response){var rowsData=response.data.rows.map(function(row){var data=response.data.columns.map(function(col){return row[col.name];});return data;});setTableData({columns:response.data.columns,rows:rowsData});setLoading(false);});}},[selection,authInfo.csrf]);var handleSelection=function handleSelection(event){event.preventDefault();setTableData({rows:[],columns:[]});setLoading(true);var selection={library:event.target[0].value,table:event.target[1].value};setSelection(selection);};return/*#__PURE__*/_jsxs(Container,{className:\"justify-content-md-center\",children:[/*#__PURE__*/_jsx(JobSelector,{onSelect:handleSelection}),tableData.rows.length!==tableData.columns.length?/*#__PURE__*/_jsx(TableViewer,{data:tableData}):/*#__PURE__*/_jsx(Loading,{status:loading})]});}export default Jobs;","map":{"version":3,"names":["useEffect","useState","useContext","useHistory","Instance","AuthContext","Container","JobSelector","TableViewer","Loading","Jobs","authInfo","setAuthInfo","library","table","selection","setSelection","rows","columns","tableData","setTableData","loading","setLoading","history","authenticated","push","csrf","endpoint","get","then","response","job","data","headers","params","_program","reqType","lib","ds","rowsData","map","row","col","name","handleSelection","event","preventDefault","target","value","length"],"sources":["C:/Users/sinajp/OneDrive - SAS/Documents/GitHub/ajay17m.github.io-1/viya_app/src/pages/Jobs.js"],"sourcesContent":["import { useEffect, useState, useContext } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport Instance from '../apis/Instance';\n\nimport { AuthContext } from '../contexts';\n\nimport Container from 'react-bootstrap/Container';\n\nimport JobSelector from '../components/Selectors/JobSelector';\nimport TableViewer from '../components/TableViewer/TableViewer';\nimport Loading from '../components/Loading';\n\nfunction Jobs() {\n    const { authInfo, setAuthInfo } = useContext(AuthContext);\n    const [selection, setSelection] = useState({ library: null, table: null });\n    const [tableData, setTableData] = useState({ rows: [], columns: [] });\n    const [loading, setLoading] = useState(false);\n    const history = useHistory();\n\n    useEffect(() => {\n        if (authInfo.authenticated === false) {\n            history.push(\"/logon\");\n        }\n    }, [authInfo.authenticated, history]);\n\n    useEffect(() => {\n        if (authInfo.authenticated === true && !(\"job\" in authInfo.csrf)) {\n            const endpoint = \"SASJobExecution/csrf\";\n            Instance.get(endpoint)\n                .then(response => {\n                    setAuthInfo({ ...authInfo, csrf: { ...authInfo.csrf, job: response.data }});\n                });\n        }\n    }, [authInfo, setAuthInfo]);\n\n    useEffect(() => {\n        if (selection.table !== null) {\n            const endpoint = \"SASJobExecution/\";\n            const headers = {\n                'X-CSRF-HEADER': 'X-CSRF-TOKEN',\n                'X-CSRF-TOKEN': authInfo.csrf.job\n            }\n            const params = {\n                _program: \"/gelcontent/Demo/VISUAL/Jobs/extractData\",\n                reqType: \"getdata\",\n                lib: selection.library,\n                ds: selection.table\n            };\n            Instance.get(endpoint, { headers: headers, params: params })\n                .then(response => {\n                    const rowsData = response.data.rows.map(row => {\n                        const data = response.data.columns.map(col => row[col.name]);\n                        return data;\n                    })\n                    setTableData({ columns: response.data.columns, rows: rowsData });\n                    setLoading(false);\n                });\n        }\n    }, [selection, authInfo.csrf]);\n\n    const handleSelection = (event) => {\n        event.preventDefault();\n        setTableData({ rows: [], columns: [] });\n        setLoading(true);\n        const selection = { library: event.target[0].value, table: event.target[1].value };\n        setSelection(selection);\n    };\n\n    return (\n        <Container className=\"justify-content-md-center\">\n            <JobSelector onSelect={handleSelection} />\n            {tableData.rows.length !== tableData.columns.length ? <TableViewer data={tableData} /> : <Loading status={loading} />}\n        </Container>\n    )\n}\n\nexport default Jobs;"],"mappings":"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"},"metadata":{},"sourceType":"module"}