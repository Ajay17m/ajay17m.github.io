{"ast":null,"code":"import _objectSpread from\"C:/Users/sinajp/OneDrive - SAS/Documents/GitHub/ajay17m.github.io-1/viya_app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/sinajp/OneDrive - SAS/Documents/GitHub/ajay17m.github.io-1/viya_app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState,useContext}from'react';import{useHistory}from'react-router-dom';import Instance from'../apis/Instance';import{AuthContext}from'../contexts';import Container from'react-bootstrap/Container';import CASSelector from'../components/Selectors/CASSelector';import TableViewer from'../components/TableViewer/TableViewer';import Loading from'../components/Loading';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CAS(){var _useContext=useContext(AuthContext),authInfo=_useContext.authInfo,setAuthInfo=_useContext.setAuthInfo;var _useState=useState({library:null,table:null}),_useState2=_slicedToArray(_useState,2),selection=_useState2[0],setSelection=_useState2[1];var _useState3=useState({rows:[],columns:[]}),_useState4=_slicedToArray(_useState3,2),tableData=_useState4[0],setTableData=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var history=useHistory();useEffect(function(){if(authInfo.authenticated===false){history.push(\"/logon\");}},[authInfo.authenticated,history]);useEffect(function(){if(authInfo.authenticated===true&&!(\"cas\"in authInfo.session)){var endpoint='/cas-shared-default-http/cas/sessions';Instance.post(endpoint).then(function(response){setAuthInfo(_objectSpread(_objectSpread({},authInfo),{},{session:_objectSpread(_objectSpread({},authInfo.session),{},{cas:response.data.session})}));});}},[authInfo,setAuthInfo]);useEffect(function(){if(authInfo.session.cas!==\"\"&&selection.table!==null){var endpoint=\"/cas-shared-default-http/cas/sessions/\".concat(authInfo.session.cas,\"/actions/table.fetch\");var data={\"table\":{\"caslib\":selection.library,\"name\":selection.table}};var headers={\"accept\":\"application/json\",\"content-type\":\"application/json\"};Instance.post(endpoint,data,{headers:headers}).then(function(response){if(response.data.results.Fetch.schema.length>0){var result=response.data.results.Fetch;setTableData({rows:result.rows,columns:result.schema});}});}},[selection,authInfo.session]);var handleSelection=function handleSelection(event){event.preventDefault();setTableData({rows:[],columns:[]});setLoading(true);var selection={library:event.target[0].value,table:event.target[1].value};setSelection(selection);};return/*#__PURE__*/_jsxs(Container,{className:\"justify-content-md-center\",children:[/*#__PURE__*/_jsx(CASSelector,{onSelect:handleSelection}),tableData.rows.length!==tableData.columns.length?/*#__PURE__*/_jsx(TableViewer,{data:tableData}):/*#__PURE__*/_jsx(Loading,{status:loading})]});};export default CAS;","map":{"version":3,"names":["useEffect","useState","useContext","useHistory","Instance","AuthContext","Container","CASSelector","TableViewer","Loading","CAS","authInfo","setAuthInfo","library","table","selection","setSelection","rows","columns","tableData","setTableData","loading","setLoading","history","authenticated","push","session","endpoint","post","then","response","cas","data","headers","results","Fetch","schema","length","result","handleSelection","event","preventDefault","target","value"],"sources":["C:/Users/sinajp/OneDrive - SAS/Documents/GitHub/ajay17m.github.io-1/viya_app/src/pages/Cas.js"],"sourcesContent":["import { useEffect, useState, useContext } from 'react';\r\nimport { useHistory} from 'react-router-dom';\r\nimport Instance from '../apis/Instance';\r\n\r\nimport { AuthContext } from '../contexts';\r\n\r\nimport Container from 'react-bootstrap/Container';\r\n\r\nimport CASSelector from '../components/Selectors/CASSelector';\r\nimport TableViewer from '../components/TableViewer/TableViewer';\r\nimport Loading from '../components/Loading';\r\n\r\nfunction CAS() {\r\n    const { authInfo, setAuthInfo } = useContext(AuthContext);\r\n    const [selection, setSelection] = useState({ library: null, table: null });\r\n    const [tableData, setTableData] = useState({ rows: [], columns: [] });\r\n    const [loading, setLoading] = useState(false);\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        if (authInfo.authenticated === false) {\r\n            history.push(\"/logon\");\r\n        }\r\n    },[authInfo.authenticated, history]);\r\n\r\n    useEffect(() => {\r\n        if (authInfo.authenticated === true && !(\"cas\" in authInfo.session) ) {\r\n            const endpoint = '/cas-shared-default-http/cas/sessions';\r\n            Instance.post(endpoint)\r\n                .then(response => {\r\n                    setAuthInfo({ ...authInfo, session: { ...authInfo.session, cas: response.data.session }});\r\n                })\r\n        }\r\n    }, [authInfo, setAuthInfo]);\r\n\r\n    useEffect(() => {\r\n        if (authInfo.session.cas !== \"\" && selection.table !== null) {\r\n            const endpoint = `/cas-shared-default-http/cas/sessions/${authInfo.session.cas}/actions/table.fetch`;\r\n            const data = {\r\n                \"table\":{\r\n                    \"caslib\":selection.library,\r\n                    \"name\":selection.table\r\n                }\r\n            }\r\n            const headers = {\r\n                \"accept\": \"application/json\",\r\n                \"content-type\": \"application/json\"\r\n            };\r\n            Instance.post(endpoint, data,{headers: headers} )\r\n                .then(response => {\r\n                    if (response.data.results.Fetch.schema.length > 0) {\r\n                        const result = response.data.results.Fetch;\r\n                        setTableData({ rows: result.rows, columns: result.schema });\r\n                    }\r\n                });\r\n        }\r\n    }, [selection, authInfo.session]);\r\n\r\n    const handleSelection = (event) => {\r\n        event.preventDefault();\r\n        setTableData({ rows: [], columns: [] });\r\n        setLoading(true);\r\n        const selection = { library: event.target[0].value, table: event.target[1].value };\r\n        setSelection(selection);\r\n    };\r\n\r\n    return (\r\n        <Container className=\"justify-content-md-center\">\r\n            <CASSelector onSelect={handleSelection}/>\r\n            {tableData.rows.length !== tableData.columns.length ? <TableViewer data={tableData} /> : <Loading status={loading} />}\r\n        </Container>\r\n    )\r\n};\r\n\r\nexport default CAS;"],"mappings":"mUAAA,OAASA,SAAT,CAAoBC,QAApB,CAA8BC,UAA9B,KAAgD,OAAhD,CACA,OAASC,UAAT,KAA0B,kBAA1B,CACA,MAAOC,SAAP,KAAqB,kBAArB,CAEA,OAASC,WAAT,KAA4B,aAA5B,CAEA,MAAOC,UAAP,KAAsB,2BAAtB,CAEA,MAAOC,YAAP,KAAwB,qCAAxB,CACA,MAAOC,YAAP,KAAwB,uCAAxB,CACA,MAAOC,QAAP,KAAoB,uBAApB,C,wFAEA,QAASC,IAAT,EAAe,CACX,gBAAkCR,UAAU,CAACG,WAAD,CAA5C,CAAQM,QAAR,aAAQA,QAAR,CAAkBC,WAAlB,aAAkBA,WAAlB,CACA,cAAkCX,QAAQ,CAAC,CAAEY,OAAO,CAAE,IAAX,CAAiBC,KAAK,CAAE,IAAxB,CAAD,CAA1C,wCAAOC,SAAP,eAAkBC,YAAlB,eACA,eAAkCf,QAAQ,CAAC,CAAEgB,IAAI,CAAE,EAAR,CAAYC,OAAO,CAAE,EAArB,CAAD,CAA1C,yCAAOC,SAAP,eAAkBC,YAAlB,eACA,eAA8BnB,QAAQ,CAAC,KAAD,CAAtC,yCAAOoB,OAAP,eAAgBC,UAAhB,eACA,GAAMC,QAAO,CAAGpB,UAAU,EAA1B,CAEAH,SAAS,CAAC,UAAM,CACZ,GAAIW,QAAQ,CAACa,aAAT,GAA2B,KAA/B,CAAsC,CAClCD,OAAO,CAACE,IAAR,CAAa,QAAb,EACH,CACJ,CAJQ,CAIP,CAACd,QAAQ,CAACa,aAAV,CAAyBD,OAAzB,CAJO,CAAT,CAMAvB,SAAS,CAAC,UAAM,CACZ,GAAIW,QAAQ,CAACa,aAAT,GAA2B,IAA3B,EAAmC,EAAE,OAASb,SAAQ,CAACe,OAApB,CAAvC,CAAsE,CAClE,GAAMC,SAAQ,CAAG,uCAAjB,CACAvB,QAAQ,CAACwB,IAAT,CAAcD,QAAd,EACKE,IADL,CACU,SAAAC,QAAQ,CAAI,CACdlB,WAAW,gCAAMD,QAAN,MAAgBe,OAAO,gCAAOf,QAAQ,CAACe,OAAhB,MAAyBK,GAAG,CAAED,QAAQ,CAACE,IAAT,CAAcN,OAA5C,EAAvB,GAAX,CACH,CAHL,EAIH,CACJ,CARQ,CAQN,CAACf,QAAD,CAAWC,WAAX,CARM,CAAT,CAUAZ,SAAS,CAAC,UAAM,CACZ,GAAIW,QAAQ,CAACe,OAAT,CAAiBK,GAAjB,GAAyB,EAAzB,EAA+BhB,SAAS,CAACD,KAAV,GAAoB,IAAvD,CAA6D,CACzD,GAAMa,SAAQ,iDAA4ChB,QAAQ,CAACe,OAAT,CAAiBK,GAA7D,wBAAd,CACA,GAAMC,KAAI,CAAG,CACT,QAAQ,CACJ,SAASjB,SAAS,CAACF,OADf,CAEJ,OAAOE,SAAS,CAACD,KAFb,CADC,CAAb,CAMA,GAAMmB,QAAO,CAAG,CACZ,SAAU,kBADE,CAEZ,eAAgB,kBAFJ,CAAhB,CAIA7B,QAAQ,CAACwB,IAAT,CAAcD,QAAd,CAAwBK,IAAxB,CAA6B,CAACC,OAAO,CAAEA,OAAV,CAA7B,EACKJ,IADL,CACU,SAAAC,QAAQ,CAAI,CACd,GAAIA,QAAQ,CAACE,IAAT,CAAcE,OAAd,CAAsBC,KAAtB,CAA4BC,MAA5B,CAAmCC,MAAnC,CAA4C,CAAhD,CAAmD,CAC/C,GAAMC,OAAM,CAAGR,QAAQ,CAACE,IAAT,CAAcE,OAAd,CAAsBC,KAArC,CACAf,YAAY,CAAC,CAAEH,IAAI,CAAEqB,MAAM,CAACrB,IAAf,CAAqBC,OAAO,CAAEoB,MAAM,CAACF,MAArC,CAAD,CAAZ,CACH,CACJ,CANL,EAOH,CACJ,CArBQ,CAqBN,CAACrB,SAAD,CAAYJ,QAAQ,CAACe,OAArB,CArBM,CAAT,CAuBA,GAAMa,gBAAe,CAAG,QAAlBA,gBAAkB,CAACC,KAAD,CAAW,CAC/BA,KAAK,CAACC,cAAN,GACArB,YAAY,CAAC,CAAEH,IAAI,CAAE,EAAR,CAAYC,OAAO,CAAE,EAArB,CAAD,CAAZ,CACAI,UAAU,CAAC,IAAD,CAAV,CACA,GAAMP,UAAS,CAAG,CAAEF,OAAO,CAAE2B,KAAK,CAACE,MAAN,CAAa,CAAb,EAAgBC,KAA3B,CAAkC7B,KAAK,CAAE0B,KAAK,CAACE,MAAN,CAAa,CAAb,EAAgBC,KAAzD,CAAlB,CACA3B,YAAY,CAACD,SAAD,CAAZ,CACH,CAND,CAQA,mBACI,MAAC,SAAD,EAAW,SAAS,CAAC,2BAArB,wBACI,KAAC,WAAD,EAAa,QAAQ,CAAEwB,eAAvB,EADJ,CAEKpB,SAAS,CAACF,IAAV,CAAeoB,MAAf,GAA0BlB,SAAS,CAACD,OAAV,CAAkBmB,MAA5C,cAAqD,KAAC,WAAD,EAAa,IAAI,CAAElB,SAAnB,EAArD,cAAwF,KAAC,OAAD,EAAS,MAAM,CAAEE,OAAjB,EAF7F,GADJ,CAMH,EAED,cAAeX,IAAf"},"metadata":{},"sourceType":"module"}